<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="refresh" content="600" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clima PUC</title>
    <link
      rel="icon"
      href="{{ url_for('static', filename='clima.png') }}"
      type="image/png"
    />
    <!-- Pré-conexão para otimizar carregamento de ícones e fontes -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* RESET */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Roboto", sans-serif;
        background: #1f2a44;
        color: #fff;
        position: relative;
        min-height: 100vh;
      }
      /* SIDEBAR como elemento fixo */
      .sidebar {
        position: fixed;
        width: 80px;
        height: 100%;
        background-color: #2a3550;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px 0;
        height: 100vh;
        transition: transform 0.2s ease-in-out;
        z-index: 1000;
      }
      .sidebar.hide {
        transform: translateX(-100%);
      }
      .sidebar img {
        width: 80px;
        margin-bottom: 30px;
      }
      .sidebar .nav-item {
        margin: 20px 0;
        cursor: pointer;
        color: #fff;
      }
      .sidebar .nav-item a {
        color: inherit;
        text-decoration: none;
      }
      .sidebar .nav-item i {
        font-size: 1.8em;
      }
      .sidebar-toggle {
        display: flex;
        align-items: center;
        gap: 5px;
        margin-bottom: 20px;
      }
      .sidebar-toggle span {
        font-size: 1em;
      }
      .sidebar-toggle label {
        display: flex;
        align-items: center;
        cursor: pointer;
      }
      .sidebar-toggle .slider {
        width: 40px;
        height: 20px;
        background-color: #ccc;
        border-radius: 25px;
        position: relative;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      .sidebar-toggle .slider:before {
        content: "";
        position: absolute;
        width: 16px;
        height: 16px;
        background-color: #fff;
        border-radius: 50%;
        top: 2px;
        left: 2px;
        transition: transform 0.2s;
      }
      input[type="checkbox"] {
        display: none;
      }
      input[type="checkbox"]:checked + .slider {
        background-color: #02d7fd;
      }
      input[type="checkbox"]:checked + .slider:before {
        transform: translateX(25px);
      }
      /* Botão para esconder/mostrar sidebar */
      .sidebar-btn {
        background: none;
        border: none;
        color: #fff;
        font-size: 2em;
        cursor: pointer;
      }

      /* CONTEÚDO PRINCIPAL */
      .main-content {
        margin-left: 80px; /* Espaço para a sidebar sempre */
        padding: 20px;
        transition: margin-left 0.3s ease-in-out;
      }
      .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        margin-bottom: 10px 20px;
      }
      .top-bar h1 {
        font-size: 4em;
        text-align: center;
        margin: 0;
        flex-grow: 1;
      }
      .menu-btn {
        background: none;
        border: none;
        color: #fff;
        font-size: 2em;
        cursor: pointer;
        margin-left: 10px; /* Dá um pequeno espaçamento do lado esquerdo */
      }

      /* CARD DE CLIMA ATUAL */
      .current-weather {
        background-color: #2f3b58;
        border-radius: 20px;
        padding: 40px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 20px;
      }
      .weather-info {
        display: flex;
        flex-direction: column;
      }
      .weather-info h2 {
        font-size: 9em;
      }
      .weather-info p {
        font-size: 1.6em;
        margin-top: 10px;
      }
      .weather-icon {
        font-size: 7em;
      }
      /* CARDS DE CONDIÇÕES */
      .conditions {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
      }
      .condition-card {
        background-color: #2f3b58;
        border-radius: 15px;
        padding: 40px;
        flex: 1 1 calc(50% - 30px);
        min-width: 320px;
        text-align: center;
      }
      .condition-card h3 {
        font-size: 3em;
        margin-bottom: 5px;
        color: #ffd700;
      }
      .condition-card p {
        font-size: 2em;
      }
      /* RODAPÉ */
      .footer {
        text-align: center;
        margin-top: 20px;
        color: #ccc;
        font-size: 1.5em;
      }
      /* RESPONSIVIDADE */
      @media (max-width: 768px) {
        .top-bar h1 {
          font-size: 2.5em;
        }
        .current-weather h2 {
          font-size: 4em;
        }
        .weather-icon {
          font-size: 5em;
        }
        .condition-card {
          min-width: 280px;
          padding: 30px;
        }
        .condition-card h3 {
          font-size: 1.8em;
        }
        .condition-card p {
          font-size: 1.4em;
        }
      }
      .sidebar.hide + .main-content {
        margin-left: 0;
      }
    </style>
  </head>
  <body>
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <img
        src="{{ url_for('static', filename='loguinho.png') }}"
        alt="PUC Logo"
      />
      <!-- Toggle de temperatura na sidebar -->
      <div class="sidebar-toggle">
        <span>°C</span>
        <label>
          <input
            type="checkbox"
            id="toggleTemp"
            onclick="toggleTemperature()"
          />
          <span class="slider"></span>
        </label>
        <span>°F</span>
      </div>
      <div class="nav-item">
        <a href="/temperatura"><i class="fas fa-thermometer-4"></i></a>
      </div>
      <div class="nav-item">
        <a href="/dados"><i class="fas fa-cog"></i></a>
      </div>
    </aside>

    <!-- CONTEÚDO PRINCIPAL -->
    <div class="main-content" id="mainContent">
      <div class="top-bar">
        <button class="menu-btn" onclick="toggleSidebarVisibility()">
          <i class="fas fa-bars"></i>
        </button>
        <h1>Clima PUC</h1>
      </div>

      <!-- CARD DE CLIMA ATUAL -->
      <div class="current-weather">
        <div class="weather-info">
          <h2 class="temperature" data-temp="{{ temperature }}">
            {{ "%.f"|format(temperature) }}°C
          </h2>
          <p class="temperature-status">{{ temperature_status }}</p>
        </div>
        <div class="weather-icon">
          <i id="current-icon" class="{{ wind_icon_class }}"></i>
        </div>
      </div>

      <!-- CARDS DE CONDIÇÕES -->
      <div class="conditions">
        <div class="condition-card">
          <h3>Umidade</h3>
          <p>{{ "%.f"|format(humidity) }}%</p>
          <p>{{ humidity_status }}</p>
        </div>
        <div class="condition-card">
          <h3>Chuva</h3>
          <p>{{ "%.3f"|format(rain_level) }} mm</p>
          <p>{{ rain_status }}</p>
        </div>
        <div class="condition-card">
          <h3>Vento</h3>
          <p>{{ "%.2f"|format(wind_speed_kmh) }} km/h</p>
          <p>{{ wind_speed_status }}</p>
          <p>{{ wind_direction }}</p>
        </div>
        <div class="condition-card">
          <h3>Radiação UV</h3>
          <p>{{ "%.f"|format(uv_index) }}</p>
          <p>{{ uv_status }}</p>
        </div>
      </div>

      <!-- RODAPÉ -->
      <div class="footer">
        <p>
          Desenvolvido por alunos da <a>PUC</a>. Todos os direitos reservados.
        </p>
      </div>
    </div>

    <!-- SCRIPT PARA TOGGLE DE TEMPERATURA E SIDEBAR -->
    <script>
      function toggleTemperature() {
        const toggle = document.getElementById("toggleTemp");
        const tempElements = document.querySelectorAll(".temperature");

        tempElements.forEach((element) => {
          let originalTemp = parseFloat(element.getAttribute("data-temp")) || 0;
          let convertedTemp;
          if (toggle.checked) {
            // Converter Celsius para Fahrenheit
            convertedTemp = (originalTemp * 9) / 5 + 32;
            element.textContent = convertedTemp.toFixed(1) + " °F";
          } else {
            // Converter Fahrenheit para Celsius
            convertedTemp = ((originalTemp - 32) * 5) / 9;
            element.textContent = Math.round(convertedTemp) + " °C";
          }
          element.setAttribute("data-temp", convertedTemp.toFixed(1));
        });
      }

      function toggleSidebarVisibility() {
        const sidebar = document.getElementById("sidebar");
        const mainContent = document.getElementById("mainContent");

        sidebar.classList.toggle("hide");

        if (sidebar.classList.contains("hide")) {
          mainContent.style.marginLeft = "0"; // Move conteúdo para a esquerda
        } else {
          mainContent.style.marginLeft = "80px"; // Volta ao normal quando a sidebar reaparece
        }
        function changeIcons(data) {
          // Alterando ícone de Temperatura
          const temperatureBox = document.getElementById("temperature-box");
          const temperatureIcon = temperatureBox.querySelector("i");
          if (data.temperature > 30) {
            temperatureIcon.classList.remove("fa-thermometer-half");
            temperatureIcon.classList.add("fa-sun");
          } else {
            temperatureIcon.classList.remove("fa-sun");
            temperatureIcon.classList.add("fa-thermometer-half");
          }

          // Alterando ícone de Humidade
          const humidityBox = document.getElementById("humidity-box");
          const humidityIcon = humidityBox.querySelector("i");
          if (data.humidity < 40) {
            humidityIcon.classList.remove("fa-tint");
            humidityIcon.classList.add("fa-tint-slash");
          } else {
            humidityIcon.classList.remove("fa-tint-slash");
            humidityIcon.classList.add("fa-tint");
          }

          // Alterando ícone de Chuva
          const rainBox = document.getElementById("rain-level-box");
          const rainIcon = rainBox.querySelector("i");
          if (data.rain_level > 0.2) {
            rainIcon.classList.remove("fa-cloud");
            rainIcon.classList.add("fa-cloud-showers-heavy");
          } else {
            rainIcon.classList.remove("fa-cloud-showers-heavy");
            rainIcon.classList.add("fa-cloud");
          }

          // Alterando ícone de Radiação UV
          const uvBox = document.getElementById("uv-box");
          const uvIcon = uvBox.querySelector("i");
          if (data.uv_index > 7) {
            uvIcon.classList.remove("fa-sun");
            uvIcon.classList.add("fa-sun-cloud");
          } else {
            uvIcon.classList.remove("fa-sun-cloud");
            uvIcon.classList.add("fa-sun");
          }

          // Alterando ícone de Vento
          const windBox = document.getElementById("wind-direction-box");
          const windIcon = windBox.querySelector("i");
          windIcon.classList.remove("fa-wind");
          windIcon.classList.add("fa-wind"); // Se necessário, pode adicionar mais lógica para vento forte
        }
      }
    </script>
  </body>
</html>
